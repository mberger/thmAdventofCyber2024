<!doctype html>
<html>
  <head>
  <title>
    
      TryHackMe Advent of Cyber 2024 - Day 23 | THM Advent of Cyber 2024
    
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <!-- Use Atom -->
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="THM Advent of Cyber 2024" />
  <!-- RSS-v2.0
  <link href="/rss-feed.xml" type="application/rss+xml" rel="alternate" title="THM Advent of Cyber 2024 | a minimalist Jekyll theme for running a blog or publication"/>
  //-->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Source+Code+Pro">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-MSZW3HWGH8', 'auto');
  ga('send', 'pageview');
</script>

  <!-- Use Jekyll SEO plugin -->
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>TryHackMe Advent of Cyber 2024 - Day 23 | THM Advent of Cyber 2024</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="TryHackMe Advent of Cyber 2024 - Day 23" />
<meta name="author" content="Michael" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Story" />
<meta property="og:description" content="The Story" />
<link rel="canonical" href="http://localhost:4000/Day23" />
<meta property="og:url" content="http://localhost:4000/Day23" />
<meta property="og:site_name" content="THM Advent of Cyber 2024" />
<meta property="og:image" content="http://localhost:4000/Day23Header.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-12-23T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/Day23Header.png" />
<meta property="twitter:title" content="TryHackMe Advent of Cyber 2024 - Day 23" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Michael"},"dateModified":"2024-12-23T00:00:00-05:00","datePublished":"2024-12-23T00:00:00-05:00","description":"The Story","headline":"TryHackMe Advent of Cyber 2024 - Day 23","image":"http://localhost:4000/Day23Header.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Day23"},"url":"http://localhost:4000/Day23"}</script>
<!-- End Jekyll SEO tag -->

</head>

  <body>
    <div class="container">
      <header class="site-header">
  <h3 class="site-title">
    <a href="/">THM Advent of Cyber 2024</a>
  </h3>
  <nav class="menu-list">
    
      <a href="/about" class="menu-link">About</a>
    
      <a href="/contact" class="menu-link">Contact</a>
    
    
      <a href="https://twitter.com/mberger" class="menu-link" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
    
      <a href="feed.xml" class="menu-link" target="_blank"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
    
  </nav>
  <div class="dropdown">
    <button class="dropbtn"><i class="fa fa-bars" aria-hidden="true"></i></button>
    <div class="dropdown-content">
      
        <a href="/about" class="menu-link">About</a>
      
        <a href="/contact" class="menu-link">Contact</a>
      
      
        <a href="https://twitter.com/mberger" class="menu-link" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
      
        <a href="feed.xml" class="menu-link" target="_blank"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
      
    </div>
  </div>
</header>

      <div class="content-wrapper">
        <div class="post-content">
  <h1>
    TryHackMe Advent of Cyber 2024 - Day 23
  </h1>
  
    <span class="post-date">
  Written on
  
  December
  23rd
    ,
  2024
  by
  
    Michael
  
</span>

  
  
    <div class="featured-image">
      <img src="/assets/img/Day23Header.png">
    </div>
  
  <article>
    <p>The Story</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5f04259cf9bf5b57aed2c476/room-content/5f04259cf9bf5b57aed2c476-1731561346191.svg" alt="Task banner for day 23" /></p>

<p><em>As time went on by, something seemed funny:</em></p>

<p><em>Mayor Malware and the source of his money!</em></p>

<p><em>SOC-mas grew closer, so The Glitch better move it.</em></p>

<p><em>Gain access to the wallet so that he could prove it!</em></p>

<p>\n</p>

<p>Glitch has been investigating how Mayor Malware funds his shady operations for quite some time. Recently, the Mayor disposed of various old electronic equipment; one was an old tablet with a cracked screen. Being an avid connoisseur of active and passive reconnaissance who does not mind “dumpster diving” for the greater good, Glitch quickly picked it up before the garbage truck. Surprisingly, despite being in a terrible condition with a cracked and hazy screen, the tablet still turns on. Browsing through the various files, one PDF file that caught his attention was password-protected. It is time you work with Glitch to discover the password and uncover any evidence lurking there.</p>

<p><img src="https://assets.tryhackme.com/additional/aoc2024/gifs/AoC%20day%2023%20-%20Birthday%20attack%20-%20animation%201.gif" alt="nuts being cracked with a hammer, with each nut revealing characters of &quot;password&quot; which are then formed together" /></p>

<h2 id="learning-objectives">Learning Objectives</h2>

<p>By finishing today’s task, you will learn about:</p>

<ul>
  <li>Hash functions and hash values</li>
  <li>Saving hashed passwords</li>
  <li>Cracking hashes</li>
  <li>Finding the password of a password-protected document</li>
</ul>

<h2 id="hashed-passwords">Hashed Passwords</h2>

<p>Before we dive further, it is helpful to learn how passwords are saved in authentication systems. A long time ago, before security was a “thing”, passwords were stored in cleartext along with the associated username. When the user tries to log in, the system compares the provided password for this account with the saved one. Consequently, if a user forgets their password, someone with enough access privileges can look at the table and respond with something like, “The password for <code class="language-plaintext highlighter-rouge">joebloggs</code> is <code class="language-plaintext highlighter-rouge">ASDF1234</code>.” This was a terrible idea, especially since a database can be stolen and its content leaked online. Unfortunately, users tend to use the same password for different services. Consequently, if an adversary discovers Joe Bloggs’s password from another service, they will try it on Joe’s other accounts, such as email.</p>

<p>To protect passwords, even in the case of a data breach, companies started to save a hashed version of the password. For that, we need to use a hash function. A hash function takes an input of any size and returns a fixed size value. For example, SHA256 (Secure Hash Algorithm 256) creates a 256-bit hash value. In other words, <code class="language-plaintext highlighter-rouge">sha256sum FILE_NAME</code> will return a 256-bit hash value regardless of whether the input file is a few bytes or several gigabytes. In the terminal below, we demonstrate this with one file being 2.3 gigabytes and another being 13 bytes.</p>

<p>VMTerminal</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">user</span><span class="p">@</span><span class="nd">machine</span><span class="p">:</span><span class="o">~</span><span class="sr">/AOC2024/</span><span class="nx">example_files$</span> <span class="nx">ls</span> <span class="o">-</span><span class="nx">lh</span>
<span class="nx">total</span> <span class="mf">2.3</span><span class="nx">G</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span> <span class="mi">1</span> <span class="nx">user</span> <span class="nx">user</span> <span class="mf">2.3</span><span class="nx">G</span> <span class="nx">Oct</span> <span class="mi">24</span> <span class="mi">15</span><span class="p">:</span><span class="mi">05</span> <span class="nx">Fedora</span><span class="o">-</span><span class="nx">Workstation</span><span class="o">-</span><span class="nx">Live</span><span class="o">-</span><span class="nx">x86_64</span><span class="o">-</span><span class="mi">41</span><span class="o">-</span><span class="mf">1.4</span><span class="p">.</span><span class="nx">iso</span>
<span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">rw</span><span class="o">-</span><span class="nx">r</span><span class="o">--</span> <span class="mi">1</span> <span class="nx">user</span> <span class="nx">user</span>   <span class="mi">13</span> <span class="nx">Nov</span> <span class="mi">14</span> <span class="mi">14</span><span class="p">:</span><span class="mi">49</span> <span class="nx">hello</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">user</span><span class="p">@</span><span class="nd">machine</span><span class="p">:</span><span class="o">~</span><span class="sr">/AOC2024/</span><span class="nx">example_files$</span> <span class="nx">sha256sum</span> <span class="o">*</span>
<span class="nx">a2dd3caf3224b8f3a640d9e31b1016d2a4e98a6d7cb435a1e2030235976d6da2</span>  <span class="nx">Fedora</span><span class="o">-</span><span class="nx">Workstation</span><span class="o">-</span><span class="nx">Live</span><span class="o">-</span><span class="nx">x86_64</span><span class="o">-</span><span class="mi">41</span><span class="o">-</span><span class="mf">1.4</span><span class="p">.</span><span class="nx">iso</span>
<span class="mi">03</span><span class="nx">ba204e50d126e4674c005e04d82e84c21366780af1f43bd54a37816b6ab340</span>  <span class="nx">hello</span><span class="p">.</span><span class="nx">txt</span>
</code></pre></div></div>

<p>Therefore, instead of saving the password <code class="language-plaintext highlighter-rouge">ASDF1234</code> verbatim, its hash is saved. For instance, if MD5 (Message Digest 5) is being used, then <code class="language-plaintext highlighter-rouge">ce1bccda287f1d9e6d80dbd4cb6beb60</code> would be saved. Problem solved? Not really. Firstly, MD5 is now considered insecure. Secondly, in addition to choosing a secure hash function, we should add a <strong>salt</strong>, i.e., <em>a random string of characters</em>, to the password before hashing it. In other words, instead of saving <code class="language-plaintext highlighter-rouge">hash(password)</code> in the table, we save <code class="language-plaintext highlighter-rouge">hash(password + salt)</code> along with the salt. Consequently, when the user tries to log in, the authentication system takes their password along with the saved salt, calculates its hash and compares it with the saved hash value; if identical, they are granted access. This makes the saved passwords more immune to a variety attacks.</p>

<p>Although it is recommended to use a modern secure hashing algorithm to calculate the hash value of the password concatenated with a random salt before saving it, reality is not that shiny. In many cases, there are issues in the implementation, be it due to negligence or ignorance. In a recent story, a social media platform was discovered to have saved 600 million passwords in plaintext for seven years, despite all the security guidelines warning against that. In other words, password cracking is not over yet.</p>

<h2 id="password-protected-files">Password-Protected Files</h2>

<p>On Day 14, we saw how Mayor Malware intercepted network data to eavesdrop on the village. Technically speaking, he was attacking the confidentiality and integrity of <strong>data in transit</strong>. Today, we will explore how to view his password-protected document. Technically speaking, we will be attacking the confidentiality of the <strong>data at rest</strong>.</p>

<p>One aspect of our security requires us to protect data while it is stored on any storage device; examples include a flash memory drive, smartphone storage, laptop storage, and external drives. If an adversary gains access to any such device, we don’t want them to be able to access our files. Protecting data at rest is usually achieved by encrypting the whole disk or specific files on the disk.</p>

<p>On the other hand, encrypted storage and files can pose an obstacle for the good guys who are investigating a criminal case. Digital forensic investigators need to find a way to access the plaintext files to prove or disprove any wrongdoing. In this case, for his private investigation to succeed, Glitch must figure out how to access the encrypted PDF file on the disposed-off tablet. Glitch needs to play an offensive security role to break the security of the protected document.</p>

<h2 id="passwords">Passwords</h2>

<p>Opening a password-protected document is impossible unless we know or can find the password. The problem is that many users prefer to pick relatively easy passwords that they can remember easily and then use the same password across multiple places. Have you ever wondered which passwords are most commonly used? According to one source, the table below shows the top 15 most commonly used passwords. Interestingly, many users have opted for <code class="language-plaintext highlighter-rouge">qwerty</code>, the first six consecutive letters on a QWERTY keyboard.</p>

<table>
  <thead>
    <tr>
      <th>Rank</th>
      <th>Password</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>123456</td>
    </tr>
    <tr>
      <td>2</td>
      <td>password</td>
    </tr>
    <tr>
      <td>3</td>
      <td>12345678</td>
    </tr>
    <tr>
      <td>4</td>
      <td>qwerty</td>
    </tr>
    <tr>
      <td>5</td>
      <td>123456789</td>
    </tr>
    <tr>
      <td>6</td>
      <td>12345</td>
    </tr>
    <tr>
      <td>7</td>
      <td>1234</td>
    </tr>
    <tr>
      <td>8</td>
      <td>111111</td>
    </tr>
    <tr>
      <td>9</td>
      <td>1234567</td>
    </tr>
    <tr>
      <td>10</td>
      <td>dragon</td>
    </tr>
    <tr>
      <td>11</td>
      <td>123123</td>
    </tr>
    <tr>
      <td>12</td>
      <td>baseball</td>
    </tr>
    <tr>
      <td>13</td>
      <td>abc123</td>
    </tr>
    <tr>
      <td>14</td>
      <td>football</td>
    </tr>
    <tr>
      <td>15</td>
      <td>monkey</td>
    </tr>
  </tbody>
</table>

<p>Of course, users might get a little bit creative and might replace a character with a symbol. They might append the current year, a memorable date, or a few random characters or numbers to the original word. Knowing that Mayor Malware has a cat called Fluffy, some passwords we expect him to come up with are <code class="language-plaintext highlighter-rouge">f1uffyc4t</code> and <code class="language-plaintext highlighter-rouge">fluffy2024</code> unless he uses his name or title and creates a password such as <code class="language-plaintext highlighter-rouge">m4y0r2024</code>.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5f04259cf9bf5b57aed2c476/room-content/5f04259cf9bf5b57aed2c476-1731657787249.png" alt="Mayor Malware's cat" /> \n</p>

<h2 id="connecting-to-the-machine">Connecting to the Machine</h2>

<p>Before moving forward, review the questions in the connection card shown below:</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5f04259cf9bf5b57aed2c476/room-content/5f04259cf9bf5b57aed2c476-1731491792619.png" alt="You will need a VM that displays in split view; you are also given SSH credentials." /> \n</p>

<p>Click on the green <strong>Start Machine</strong> button below to start the virtual machine in split view. If the VM is not visible, use the blue <strong>Show Split View</strong> button at the top of the page.</p>

<p>Start Machine</p>

<p>You can also access the virtual machine using SSH at the IP address <code class="language-plaintext highlighter-rouge">10.10.53.14</code> using the following credentials:</p>

<ul>
  <li>Username: <code class="language-plaintext highlighter-rouge">user</code></li>
  <li>Password: <code class="language-plaintext highlighter-rouge">Tryhackme123!</code></li>
</ul>

<h2 id="demonstration">Demonstration</h2>

<p>Enough learning about password storage and password choices. It is time to crack some passwords. We will cover the following:</p>

<ul>
  <li>Cracking a password found in a breached database</li>
  <li>Finding the password of an encrypted PDF</li>
</ul>

<p><strong>Data Breach and Hash Values</strong></p>

<p>Mayor Malware had an online account in a now-defunct forum that was breached, and all its user data was leaked. After checking online, we were able to retrieve the Mayor’s password in hashed format. It is listed below.</p>

<table>
  <thead>
    <tr>
      <th>Username</th>
      <th>Password Hash</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">mayor@email.thm</code></td>
      <td><code class="language-plaintext highlighter-rouge">d956a72c83a895cb767bb5be8dba791395021dcece002b689cf3b5bf5aaa20ac</code></td>
    </tr>
  </tbody>
</table>

<p>We want to discover the original password. The first step in our approach is to figure out the type of the hash function. Then, we will try to hash different passwords from a password list until we find a match.</p>

<p>We have saved the above hash value in the <code class="language-plaintext highlighter-rouge">/home/user/AOC2024/hash1.txt</code> file for your convenience.</p>

<ul>
  <li>First, we will go to the <code class="language-plaintext highlighter-rouge">AOC2024</code> directory and then display the content of <code class="language-plaintext highlighter-rouge">hash1.txt</code>.</li>
  <li>Copy the displayed hash. Selecting the text in the split view will copy it for you. \n</li>
  <li>Next, we start one tool that helps identify hashes by issuing the command <code class="language-plaintext highlighter-rouge">python hash-id.py</code>.</li>
  <li>Paste the copied hash. Right-clicking with your mouse will paste the copied text in split view. \n</li>
  <li>Finally, we quit the tool using <code class="language-plaintext highlighter-rouge">CTRL</code>+<code class="language-plaintext highlighter-rouge">C</code>.</li>
</ul>

<p>The interaction is shown in the terminal output below:</p>

<p>VMTerminal</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">user</span><span class="p">@</span><span class="nd">machine</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">cd</span> <span class="nx">AOC2024</span><span class="o">/</span>
<span class="nx">user</span><span class="p">@</span><span class="nd">machine</span><span class="p">:</span><span class="o">~</span><span class="sr">/AOC2024$ cat hash1.tx</span><span class="err">t
</span><span class="nx">d956a72c83a895cb767bb5be8dba791395021dcece002b689cf3b5bf5aaa20ac</span>
<span class="nx">user</span><span class="p">@</span><span class="nd">machine</span><span class="p">:</span><span class="o">~</span><span class="sr">/AOC2024$ python hash-id.p</span><span class="err">y
</span>   <span class="err">#########################################################################</span>
   <span class="err">#########################################################################</span>
   <span class="err">#</span>     <span class="nx">__</span>  <span class="nx">__</span>                     <span class="nx">__</span>           <span class="nx">______</span>    <span class="nx">_____</span>           <span class="err">#</span>
   <span class="err">#</span>    <span class="o">/</span><span class="err">\</span> <span class="err">\</span><span class="o">/</span><span class="err">\</span> <span class="err">\</span>                   <span class="o">/</span><span class="err">\</span> <span class="err">\</span>         <span class="o">/</span><span class="err">\</span><span class="nx">__</span>  <span class="nx">_</span><span class="err">\</span>  <span class="o">/</span><span class="err">\</span>  <span class="nx">_</span> <span class="s2">`\         #
   #    \ \ \_\ \     __      ____ \ \ \___     \/_/\ \/  \ \ \/\ \        #
   #     \ \  _  \  /'__`</span><span class="err">\</span>   <span class="o">/</span> <span class="p">,</span><span class="nx">__</span><span class="err">\</span> <span class="err">\</span> <span class="err">\</span>  <span class="nx">_</span> <span class="s2">`\      \ \ \   \ \ \ \ \       #
   #      \ \ \ \ \/\ \_\ \_/\__, `</span><span class="err">\</span> <span class="err">\</span> <span class="err">\</span> <span class="err">\</span> <span class="err">\</span> <span class="err">\</span>      <span class="err">\</span><span class="nx">_</span><span class="err">\</span> <span class="err">\</span><span class="nx">__</span> <span class="err">\</span> <span class="err">\</span> <span class="err">\</span><span class="nx">_</span><span class="err">\</span> <span class="err">\</span>      <span class="err">#</span>
   <span class="err">#</span>       <span class="err">\</span> <span class="err">\</span><span class="nx">_</span><span class="err">\</span> <span class="err">\</span><span class="nx">_</span><span class="err">\</span> <span class="err">\</span><span class="nx">___</span> <span class="err">\</span><span class="nx">_</span><span class="err">\</span><span class="o">/</span><span class="err">\</span><span class="nx">____</span><span class="o">/</span>  <span class="err">\</span> <span class="err">\</span><span class="nx">_</span><span class="err">\</span> <span class="err">\</span><span class="nx">_</span><span class="err">\</span>     <span class="o">/</span><span class="err">\</span><span class="nx">_____</span><span class="err">\</span> <span class="err">\</span> <span class="err">\</span><span class="nx">____</span><span class="o">/</span>      <span class="err">#</span>
   <span class="err">#</span>        <span class="err">\</span><span class="o">/</span><span class="nx">_</span><span class="o">/</span><span class="err">\</span><span class="o">/</span><span class="nx">_</span><span class="o">/</span><span class="err">\</span><span class="o">/</span><span class="nx">__</span><span class="o">/</span><span class="err">\</span><span class="o">/</span><span class="nx">_</span><span class="o">/</span><span class="err">\</span><span class="o">/</span><span class="nx">___</span><span class="o">/</span>    <span class="err">\</span><span class="o">/</span><span class="nx">_</span><span class="o">/</span><span class="err">\</span><span class="o">/</span><span class="nx">_</span><span class="o">/</span>     <span class="err">\</span><span class="o">/</span><span class="nx">_____</span><span class="o">/</span>  <span class="err">\</span><span class="o">/</span><span class="nx">___</span><span class="o">/</span>  <span class="nx">v1</span><span class="p">.</span><span class="mi">2</span> <span class="err">#</span>
   <span class="err">#</span>                                                             <span class="nx">By</span> <span class="nx">Zion3R</span> <span class="err">#</span>
   <span class="err">#</span>                                                    <span class="nx">www</span><span class="p">.</span><span class="nx">Blackploit</span><span class="p">.</span><span class="nx">com</span> <span class="err">#</span>
   <span class="err">#</span>                                                   <span class="nx">Root</span><span class="p">@</span><span class="nd">Blackploit</span><span class="p">.</span><span class="nx">com</span> <span class="err">#</span>
   <span class="err">#########################################################################</span>
<span class="o">--------------------------------------------------</span>
 <span class="nx">HASH</span><span class="p">:</span> <span class="nx">d956a72c83a895cb767bb5be8dba791395021dcece002b689cf3b5bf5aaa20ac</span>

<span class="nx">Possible</span> <span class="nx">Hashs</span><span class="p">:</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">SHA</span><span class="o">-</span><span class="mi">256</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">Haval</span><span class="o">-</span><span class="mi">256</span>

<span class="nx">Least</span> <span class="nx">Possible</span> <span class="nx">Hashs</span><span class="p">:</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">GOST</span> <span class="nx">R</span> <span class="mf">34.11</span><span class="o">-</span><span class="mi">94</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">RipeMD</span><span class="o">-</span><span class="mi">256</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">SNEFRU</span><span class="o">-</span><span class="mi">256</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">SHA</span><span class="o">-</span><span class="mi">256</span><span class="p">(</span><span class="nx">HMAC</span><span class="p">)</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">Haval</span><span class="o">-</span><span class="mi">256</span><span class="p">(</span><span class="nx">HMAC</span><span class="p">)</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">RipeMD</span><span class="o">-</span><span class="mi">256</span><span class="p">(</span><span class="nx">HMAC</span><span class="p">)</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">SNEFRU</span><span class="o">-</span><span class="mi">256</span><span class="p">(</span><span class="nx">HMAC</span><span class="p">)</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">SHA</span><span class="o">-</span><span class="mi">256</span><span class="p">(</span><span class="nf">md5</span><span class="p">(</span><span class="nx">$pass</span><span class="p">))</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="nx">SHA</span><span class="o">-</span><span class="mi">256</span><span class="p">(</span><span class="nf">sha1</span><span class="p">(</span><span class="nx">$pass</span><span class="p">))</span>
<span class="o">--------------------------------------------------</span>
 <span class="nx">HASH</span><span class="p">:</span> <span class="o">^</span><span class="nx">C</span>

  <span class="nx">Bye</span><span class="o">!</span>
</code></pre></div></div>

<p>Next, we will try passwords from <code class="language-plaintext highlighter-rouge">rockyou.txt</code>, a popular password wordlist from a real data breach. The command is as follows:</p>

<p><code class="language-plaintext highlighter-rouge">john --format=raw-sha256 --wordlist=/usr/share/wordlists/rockyou.txt hash1.txt</code></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">john</code> starts John the Ripper; the jumbo edition is installed on the machine</li>
  <li><code class="language-plaintext highlighter-rouge">--format=raw-sha256</code> specifies the hash format, which we have figured out earlier that it is most likely a SHA-256</li>
  <li><code class="language-plaintext highlighter-rouge">--wordlist=/usr/share/wordlists/rockyou.txt</code> sets the wordlist that we will use</li>
  <li><code class="language-plaintext highlighter-rouge">hash1.txt</code> is the text file containing the hash value we are trying to crack</li>
</ul>

<p>In our first attempt, <code class="language-plaintext highlighter-rouge">john</code> calculated the SHA-256 hash value for every password in <code class="language-plaintext highlighter-rouge">rockyou.txt</code> and compared it with the hash value in <code class="language-plaintext highlighter-rouge">hash1.txt</code>. Unfortunately, no password was found, as shown in the terminal output below:</p>

<p>VMTerminal</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">user</span><span class="p">@</span><span class="nd">machine</span><span class="p">:</span><span class="o">~</span><span class="sr">/AOC2024$ john --format=raw-sha256 --wordlist=/u</span><span class="nx">sr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">wordlists</span><span class="o">/</span><span class="nx">rockyou</span><span class="p">.</span><span class="nx">txt</span> <span class="nx">hash1</span><span class="p">.</span><span class="nx">txt</span>
<span class="nx">Using</span> <span class="k">default</span> <span class="nx">input</span> <span class="nx">encoding</span><span class="p">:</span> <span class="nx">UTF</span><span class="o">-</span><span class="mi">8</span>
<span class="nx">Loaded</span> <span class="mi">1</span> <span class="nx">password</span> <span class="nf">hash </span><span class="p">(</span><span class="nx">Raw</span><span class="o">-</span><span class="nx">SHA256</span> <span class="p">[</span><span class="nx">SHA256</span> <span class="mi">256</span><span class="o">/</span><span class="mi">256</span> <span class="nx">AVX2</span> <span class="mi">8</span><span class="nx">x</span><span class="p">])</span>
<span class="nx">Warning</span><span class="p">:</span> <span class="nx">poor</span> <span class="nx">OpenMP</span> <span class="nx">scalability</span> <span class="k">for</span> <span class="k">this</span> <span class="nx">hash</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">consider</span> <span class="o">--</span><span class="nx">fork</span><span class="o">=</span><span class="mi">2</span>
<span class="nx">Will</span> <span class="nx">run</span> <span class="mi">2</span> <span class="nx">OpenMP</span> <span class="nx">threads</span>
<span class="nx">Note</span><span class="p">:</span> <span class="nx">Passwords</span> <span class="nx">longer</span> <span class="nx">than</span> <span class="mi">18</span> <span class="p">[</span><span class="nx">worst</span> <span class="k">case</span> <span class="nx">UTF</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span> <span class="nx">to</span> <span class="mi">55</span> <span class="p">[</span><span class="nx">ASCII</span><span class="p">]</span> <span class="nx">rejected</span>
<span class="nx">Press</span> <span class="dl">'</span><span class="s1">q</span><span class="dl">'</span> <span class="nx">or</span> <span class="nx">Ctrl</span><span class="o">-</span><span class="nx">C</span> <span class="nx">to</span> <span class="nx">abort</span><span class="p">,</span> <span class="dl">'</span><span class="s1">h</span><span class="dl">'</span> <span class="k">for</span> <span class="nx">help</span><span class="p">,</span> <span class="nx">almost</span> <span class="nx">any</span> <span class="nx">other</span> <span class="nx">key</span> <span class="k">for</span> <span class="nx">status</span>
<span class="mi">0</span><span class="nx">g</span> <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">03</span> <span class="nc">DONE </span><span class="p">(</span><span class="mi">2024</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">03</span> <span class="mi">09</span><span class="p">:</span><span class="mi">49</span><span class="p">)</span> <span class="mi">0</span><span class="nx">g</span><span class="o">/</span><span class="nx">s</span> <span class="mi">4765</span><span class="nx">Kp</span><span class="o">/</span><span class="nx">s</span> <span class="mi">4765</span><span class="nx">Kc</span><span class="o">/</span><span class="nx">s</span> <span class="mi">4765</span><span class="nx">KC</span><span class="o">/</span><span class="nf">s </span><span class="p">(</span><span class="mi">4510458</span><span class="nx">faruk</span><span class="p">)..</span><span class="o">*</span><span class="mi">7</span><span class="err">¡</span><span class="nx">Vamos</span><span class="o">!</span>
<span class="nx">Session</span> <span class="nx">completed</span><span class="p">.</span>
</code></pre></div></div>

<p>There is a high chance that Mayor Malware has made some transformation to his password. For example, he might have replaced <code class="language-plaintext highlighter-rouge">a</code> with <code class="language-plaintext highlighter-rouge">4</code> or added a couple of digits to his password. John can start from a long password list and attempt various common derivations from each of the passwords to increase its chances of success. This behaviour can be triggered through the use of <strong>rules</strong>. Various rules come bundled with John the Ripper’s configuration files; one is suited for lengthy wordlists, <code class="language-plaintext highlighter-rouge">--rules=wordlist</code>.</p>

<p>Adding the option <code class="language-plaintext highlighter-rouge">--rules=worldlist</code> to your <code class="language-plaintext highlighter-rouge">john</code> command line generates multiple passwords from each one. For instance, it appends and prepends single digits. It does various common substitutions; for example, <code class="language-plaintext highlighter-rouge">a</code> can be replaced with <code class="language-plaintext highlighter-rouge">@</code>, <code class="language-plaintext highlighter-rouge">i</code> can be replaced with <code class="language-plaintext highlighter-rouge">!</code>, and <code class="language-plaintext highlighter-rouge">s</code> can be replaced with <code class="language-plaintext highlighter-rouge">$</code>. Many more mutations and transformations are part of these rules. You can check all the underlying rules by checking the <code class="language-plaintext highlighter-rouge">[List.Rules:Wordlist]</code> section in <code class="language-plaintext highlighter-rouge">/etc/john/john.conf</code>, John’s configuration file. Unlike the first attempt, using John with this option should crack the hash for you: \n <code class="language-plaintext highlighter-rouge">john --format=raw-sha256 --rules=wordlist --wordlist=/usr/share/wordlists/rockyou.txt hash1.txt</code></p>

<p>We should note that <code class="language-plaintext highlighter-rouge">john</code> will not spend computing resources to crack an already-cracked password hash. Consequently, if you repeat a command that has successfully found a password earlier, you will get a message like “No password hashes left to crack (see FAQ)”. Let’s say that you executed the command listed above and you recovered the password; then, the next time you want to see that password, you would use <code class="language-plaintext highlighter-rouge">john</code> with the <code class="language-plaintext highlighter-rouge">--show</code> option, for example, <code class="language-plaintext highlighter-rouge">john --format=raw-sha256 --show hash1.txt</code>.</p>

<p><strong>Data Breach and Hash Values</strong></p>

<p>Glitch has discovered Mayor Malware’s password used on the breached online forum. Although there is a high chance that this password will be used to access other online accounts created by the Mayor, Glitch does not want to go that route as it would violate the local laws and regulations. Instead of attempting anything illegal, he focused on the data he discovered in the Mayor’s trash. There is one interesting-looking PDF file that happens to be password-protected. You can help Glitch break it.</p>

<p>The first thing you need to do is to convert the password-protected file into a format that <code class="language-plaintext highlighter-rouge">john</code> can attack. Luckily, John the Ripper jumbo edition comes with the necessary tools. The different tools follow the naming style “format2john”. The terminal below shows a few examples.</p>

<p>VMTerminal</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">user</span><span class="p">@</span><span class="nd">machine</span><span class="p">:</span><span class="o">~</span><span class="sr">/AOC2024$ ls /</span><span class="nx">opt</span><span class="o">/</span><span class="nx">john</span><span class="cm">/*2john*
/opt/john/1password2john.py      /opt/john/ethereum2john.py          /opt/john/openssl2john.py
/opt/john/7z2john.pl             /opt/john/filezilla2john.py         /opt/john/padlock2john.py
/opt/john/DPAPImk2john.py        /opt/john/geli2john.py              /opt/john/pcap2john.py
/opt/john/adxcsouf2john.py       /opt/john/gpg2john                  /opt/john/pdf2john.pl
/opt/john/aem2john.py            /opt/john/hccap2john                /opt/john/pdf2john.py
/opt/john/aix2john.pl            /opt/john/hccapx2john.py            /opt/john/pem2john.py
/opt/john/aix2john.py            /opt/john/htdigest2john.py          /opt/john/pfx2john.py
[...]
</span></code></pre></div></div>

<p>You are interested in a password-protected PDF; therefore, <code class="language-plaintext highlighter-rouge">pdf2john.pl</code> should do the job perfectly for you. In the terminal below, you can see how to create a hash challenge from a PDF file. This hash value can later be fed to <code class="language-plaintext highlighter-rouge">john</code> to crack it.</p>

<p>VMTerminal</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">user</span><span class="p">@</span><span class="nd">machine</span><span class="p">:</span><span class="o">~</span><span class="sr">/AOC2024$ pdf2john.pl private.pdf &gt; pdf.has</span><span class="err">h
</span><span class="nx">user</span><span class="p">@</span><span class="nd">machine</span><span class="p">:</span><span class="o">~</span><span class="sr">/AOC2024$ cat pdf.has</span><span class="err">h
</span><span class="kr">private</span><span class="p">.</span><span class="nx">pdf</span><span class="p">:</span><span class="nx">$pdf$2</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="mi">128</span><span class="o">*-</span><span class="mi">1028</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">16</span><span class="o">*</span><span class="nx">c1e77e30a0456552cb8a5327241559bd</span><span class="o">*</span><span class="mi">32</span><span class="o">*</span><span class="mi">3</span><span class="nx">dc175eae491edc29b937e4fdbda766c00000000000000000000000000000000</span><span class="o">*</span><span class="mi">32</span><span class="o">*</span><span class="mi">6</span><span class="nx">a1b5158d8d6dd9e8380f87b624da6cc936075fd41dc3c76acf2d90db62e4a27</span>
</code></pre></div></div>

<p>The first step to consider would be trying a long wordlist such as <code class="language-plaintext highlighter-rouge">rockyou.txt</code>; moreover, you might even use a rule such as <code class="language-plaintext highlighter-rouge">--rules=wordlist</code> to test derived passwords. In this case, neither approach works; Mayor Malware has picked a password that does not exist in these public wordlists and is not derived from any word found there. Knowing Mayor Malware, we see what he holds dear, which can hint at what he would consider for his password. Therefore, you need to create your own wordlist with the following words:</p>

<ul>
  <li>Fluffy</li>
  <li>FluffyCat</li>
  <li>Mayor</li>
  <li>Malware</li>
  <li>MayorMalware</li>
</ul>

<p>And save it as <code class="language-plaintext highlighter-rouge">wordlist.txt</code>. We have saved the above words in the <code class="language-plaintext highlighter-rouge">/home/user/AOC2024/wordlist.txt</code> file for your convenience. Consequently, our command would be:</p>

<p><code class="language-plaintext highlighter-rouge">john --rules=single --wordlist=wordlist.txt pdf.hash</code></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--rules=single</code> covers more modification rules and transformations on the wordlist</li>
  <li><code class="language-plaintext highlighter-rouge">--wordlist=wordlist.txt</code> is the custom and personalized wordlist that we created</li>
  <li><code class="language-plaintext highlighter-rouge">pdf.hash</code> is the hash generated from the password-protected document</li>
</ul>

<p>Now, you have gained all the necessary knowledge to tackle the questions below and uncover what Mayor Malware has been hiding in his password-protected document.</p>

<p>Answer the questions below</p>

<p>Crack the hash value stored in <code class="language-plaintext highlighter-rouge">hash1.txt</code>. What was the password?</p>

<p>fluffycat12</p>

<p>What is the flag at the top of the <code class="language-plaintext highlighter-rouge">private.pdf</code> file?</p>

<p>THM{do_not_GET_CAUGHT}</p>

<p>To learn more about cryptography, we recommend the <a href="https://tryhackme.com/module/cryptography-101">Cryptography</a> module. If you want to practice more hash cracking, please consider the <a href="https://tryhackme.com/r/room/johntheripperbasics">John the Ripper: The Basics</a> room.</p>

  </article>
  
    <div class="post-share">
  <div class="post-date">Feel free to share!</div>
  <div class="sharing-icons">
    <a href="https://twitter.com/intent/tweet?text=TryHackMe Advent of Cyber 2024 - Day 23&amp;url=/Day23" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=/Day23&amp;title=TryHackMe Advent of Cyber 2024 - Day 23" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
  </div>
</div>

  
  
    <div class="related">
  <h2>You may also enjoy...</h2>
  
  <ul class="related-posts">
    
  </ul>
</div>

  
  
    <section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = "millennial-3";
    var disqus_identifier = "/Day23";
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

  
</div>

      </div>
      <footer class="footer">
  
    <a href="https://twitter.com/mberger" class="menu-link" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
  
    <a href="feed.xml" class="menu-link" target="_blank"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
  
  <div class="footer-description"><a href="/">THM Advent of Cyber 2024 | a minimalist Jekyll theme for running a blog or publication by Michael</a></div>
</footer>

    </div>
  </body>
</html>
