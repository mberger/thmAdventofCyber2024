<!doctype html>
<html>
  <head>
  <title>
    
      TryHackMe Advent of Cyber - Day 17 | THM Advent of Cyber 2024
    
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <!-- Use Atom -->
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="THM Advent of Cyber 2024" />
  <!-- RSS-v2.0
  <link href="/rss-feed.xml" type="application/rss+xml" rel="alternate" title="THM Advent of Cyber 2024 | a minimalist Jekyll theme for running a blog or publication"/>
  //-->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Source+Code+Pro">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-MSZW3HWGH8', 'auto');
  ga('send', 'pageview');
</script>

  <!-- Use Jekyll SEO plugin -->
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>TryHackMe Advent of Cyber - Day 17 | THM Advent of Cyber 2024</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="TryHackMe Advent of Cyber - Day 17" />
<meta name="author" content="Michael" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Story" />
<meta property="og:description" content="The Story" />
<link rel="canonical" href="http://localhost:4000/Day17" />
<meta property="og:url" content="http://localhost:4000/Day17" />
<meta property="og:site_name" content="THM Advent of Cyber 2024" />
<meta property="og:image" content="http://localhost:4000/Day17Header.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-12-17T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/Day17Header.png" />
<meta property="twitter:title" content="TryHackMe Advent of Cyber - Day 17" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Michael"},"dateModified":"2024-12-17T00:00:00-05:00","datePublished":"2024-12-17T00:00:00-05:00","description":"The Story","headline":"TryHackMe Advent of Cyber - Day 17","image":"http://localhost:4000/Day17Header.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Day17"},"url":"http://localhost:4000/Day17"}</script>
<!-- End Jekyll SEO tag -->

</head>

  <body>
    <div class="container">
      <header class="site-header">
  <h3 class="site-title">
    <a href="/">THM Advent of Cyber 2024</a>
  </h3>
  <nav class="menu-list">
    
      <a href="/about" class="menu-link">About</a>
    
      <a href="/contact" class="menu-link">Contact</a>
    
    
      <a href="https://twitter.com/mberger" class="menu-link" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
    
      <a href="feed.xml" class="menu-link" target="_blank"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
    
  </nav>
  <div class="dropdown">
    <button class="dropbtn"><i class="fa fa-bars" aria-hidden="true"></i></button>
    <div class="dropdown-content">
      
        <a href="/about" class="menu-link">About</a>
      
        <a href="/contact" class="menu-link">Contact</a>
      
      
        <a href="https://twitter.com/mberger" class="menu-link" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
      
        <a href="feed.xml" class="menu-link" target="_blank"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
      
    </div>
  </div>
</header>

      <div class="content-wrapper">
        <div class="post-content">
  <h1>
    TryHackMe Advent of Cyber - Day 17
  </h1>
  
    <span class="post-date">
  Written on
  
  December
  17th,
  2024
  by
  
    Michael
  
</span>

  
  
    <div class="featured-image">
      <img src="/assets/img/Day17Header.png">
    </div>
  
  <article>
    <h1 id="the-story">The Story</h1>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5ed5961c6276df568891c3ea/room-content/5ed5961c6276df568891c3ea-1731684332887.svg" alt="Task banner for day DAY 10" /></p>

<p><em>An attack now, it seems, on the town’s CCTV,</em></p>

<p><em>There’s a problem with the logs, but what could it be?</em></p>

<p><em>An idea put forward of a log format switch,</em></p>

<p><em>Not as expected, the idea of the Glitch!</em></p>

<h2 id="background-story">Background Story</h2>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732019992567.png" alt="Picture of McSkidy Cindy Lou in deep thought." title="right-50" /></p>

<p>Marta May Ware is going crazy: someone has disconnected the main server from the Wareville network, and nobody knows who it is! As soon as she realized it, she contacted Wareville’s top physical security company, WareSec&amp;Aware, to let her view the data centre’s CCTV streams. They forbade it entirely: for privacy reasons, only the camera owner can view the recordings. Not even the WareSec&amp;Aware employees themselves are allowed to do so.</p>

<p>Still, they said there was no recording of anybody entering the data centre yesterday! How could that be, wondered Marta May, desperate for answers. Their first supposition was that the owner of the cameras must have deleted the recordings from their managing web page. But the data centre’s camera owner surely can’t be the perpetrator: it is no other than Byte, Glitch’s dog! Glitch insisted with Marta to leave the ownership of the cameras to Byte precisely to avoid these kinds of happenings: Byte, the ultimate good boy, combines loyalty and sharp instincts to keep any place safe.</p>

<p>Marta May calls Glitch and McSkidy right away, explaining the situation in between the sobs. Glitch’s eyes darken: Someone is trying to frame Byte, and he will not let anybody vex his beautiful dog!</p>

<p>McSkidy is perplexed: why are the people at WareSec&amp;Aware “supposing” that Byte had deleted the recordings? Shouldn’t they have some logs to prove such an accusation?</p>

<p>Marta May has the answer: they do have some log files that they back up every 6 hours, give or take.</p>

<p>But they can’t search through it—or rather, they tried, but when they go and search for some keyword like the data centre’s cameras’ IDs or the action “delete”, this is what they get: \n</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@tryhackme<span class="nv">$ </span><span class="nb">cat </span>cctv_logs.log| <span class="nb">grep</span> <span class="nt">-i</span> <span class="s2">"11"</span>
2024-12-16 22:53:06 WatchCamera 5 byte 11 rij5uu4gt204q0d3eb7jj86okt
RecordingInfo: 1 11 rij5uu4gt204q0d3eb7jj86okt
2024-12-16 22:53:22 WatchCamera 5 byte 11 rij5uu4gt204q0d3eb7jj86okt
RecordingInfo: 1 11 rij5uu4gt204q0d3eb7jj86okt
2024-12-16 22:53:25 WatchCamera 5 byte 11 rij5uu4gt204q0d3eb7jj86okt
user@tryhackme<span class="err">$</span>
user@tryhackme<span class="nv">$ </span><span class="nb">cat </span>cctv_logs.log| <span class="nb">grep</span> <span class="nt">-i</span> <span class="s2">"download"</span>
2024-12-16 22:52:50 DownloadRecording 5 byte 51 10 opfg6ns9khsbpq0u4us6dro2m8
</code></pre></div></div>

<p>Unreadable!</p>

<p>McSkidy shakes her head: they must immediately send the log file to the SOC team! Armed with a SIEM, no log is unsearchable!</p>

<h2 id="learning-objectives">Learning Objectives</h2>

<p>In this task, we will explore the following learning objectives while investigating the logs related to the incident scenario explained above:</p>

<ul>
  <li>Learn how to extract custom fields in Splunk</li>
  <li>Learn to create a parser for the custom logs</li>
  <li>Filter and narrow down the search results using Search Processing Language (SPL)</li>
  <li>How to investigate in Splunk</li>
</ul>

<h2 id="connecting-to-the-machine">Connecting to the Machine</h2>

<p>Before moving forward, review the questions in the connection card below and start the virtual machine by pressing the <strong>Start Machine</strong> button. The VM should be fully loaded in 3 minutes.</p>

<p>Start Machine</p>

<p><strong>Connection Details</strong></p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5dbea226085ab6182a2ee0f7/room-content/5dbea226085ab6182a2ee0f7-1730218395891.png" alt="Connection card." title="right-50" /></p>

<p>Once the machine is up and running, we can connect to the Splunk SIEM by visiting <a href="https://lab_web_url.p.thmlabs.com/">https://LAB_WEB_URL.p.thmlabs.com</a> in your browser.</p>

<h2 id="investigation-time">Investigation Time</h2>

<p>It’s time to fire up Splunk, where the data has been pre-ingested for us to investigate the incident. Once the lab is connected, open up the link in the browser and click on <strong>Search &amp; Reporting</strong> on the left.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732792280322.png" alt="Splunk Interface" /></p>

<p>On the next page, type <code class="language-plaintext highlighter-rouge">index=*</code> in the search bar to show all ingested logs. Note that we will need to select <code class="language-plaintext highlighter-rouge">All time</code> as the time frame from the drop-down on the right of the search bar.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732792280326.png" alt="Splunk Search Head" /></p>

<p>After running the query, we will be presented with two separate datasets pre-ingested to Splunk. We can verify this by clicking on the <code class="language-plaintext highlighter-rouge">sourcetype</code> field in the fields list on the left of the page.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732622163783.png" alt="Searching in Splunk" /></p>

<p>The two datasets are as follows:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">web_logs</code>: This file contains events related to web connections to and from the CCTV web server.</li>
  <li><code class="language-plaintext highlighter-rouge">cctv_logs</code>: This file contains information about the CCTV application access logs.</li>
</ul>

<p>Let’s explore the logs and investigate the attack on our CCTV servers to identify the culprit, who got unauthorized access to the server and deleted the CCTV streams.</p>

<p><strong>Examining CCTV Logs</strong></p>

<p>Let’s start our investigation by examining the CCTV logs. To do so, we can either click on the corresponding value for the <code class="language-plaintext highlighter-rouge">sourcetype</code> field, or type the following query in the search bar:</p>

<p><code class="language-plaintext highlighter-rouge">index=* sourcetype=cctv_logs</code></p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732622555844.png" alt="Examine the logs in Splunk" /></p>

<h2 id="understanding-the-problem">Understanding the Problem</h2>

<p>After examining the logs, we can figure out the following main issues:</p>

<ul>
  <li>Logs are not parsed properly by Splunk.</li>
  <li>Splunk does not consider the actual timeline of the event; instead, it uses only the ingestion time.</li>
</ul>

<h2 id="fixing-the-problem">Fixing the Problem</h2>

<p>Before analysing and investigating the logs, we must extract the relevant fields from them and adjust the timestamp.</p>

<p>The provided logs were generated from a custom log source, so Splunk could not parse the fields properly.</p>

<p><strong>Extract New Field</strong></p>

<p>Click on the <code class="language-plaintext highlighter-rouge">Extract New Fields</code> option, located below the fields list on the left of the page.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732795521604.png" alt="Extract New fields from Logs" /> \n</p>

<p><strong>Select Sample Event</strong></p>

<p>We will be presented with event logs that must be parsed properly. Though, we can select any log, but in order to follow the steps mentioned below, and avoid confusion, let’s select the very first sample event and click on the green <code class="language-plaintext highlighter-rouge">Next</code> button at the top of the page.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732795521628.png" alt="Select Sample Event" /></p>

<p><strong>Select Method</strong></p>

<p>There are two options for extracting the fields: using Regular Expressions and using Delimiters. In this exercise, we will extract fields using Regular Expressions. Select this option and then click on the green <code class="language-plaintext highlighter-rouge">Next</code> button at the top of the page.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732795522203.png" alt="Select the Method" /></p>

<p><strong>Select Fields</strong></p>

<p>Now, to select the fields in the logs that we want to extract, we simply need to highlight them in the sample log. Splunk will autogenerate the regex (regular expression) to extract the selected field.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732624360904.gif" alt="Select Fields" /></p>

<p>We’ll assign an appropriate name to each of the extracted fields based on the table below:</p>

<table>
  <thead>
    <tr>
      <th><strong>Timestamp</strong></th>
      <th><strong>Event</strong></th>
      <th><strong>User_id</strong></th>
      <th><strong>UserName</strong></th>
      <th><strong>Session_id</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2024-12-16 17:20:01</td>
      <td>Logout</td>
      <td>5</td>
      <td>byte</td>
      <td>kla95sklml7nd14dbosc8q6vop</td>
    </tr>
  </tbody>
</table>

<p>As evident from the preview section, by selecting the fields, Splunk creates a regular expression to extract that field from all the events.</p>

<p>All the extracted fields will be displayed in the Preview tab, as shown below:</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732796660869.png" alt="Select Fields" /></p>

<p>It is important to note that some of the logs may have a different format, and they may not be parsed using the parser we created above. We may have to re-extract the fields from those events. We will get back to fixing this issue later. \n</p>

<p>We can click on each extracted field to check the extracted values. When we’re satisfied with the extracted values, we can click on the green <code class="language-plaintext highlighter-rouge">Next</code> button at the top of the page.</p>

<p><strong>Validate</strong></p>

<p>In the next step, we will see a green tick mark next to the sample logs to indicate the correct extraction of the fields, or a red cross sign to signal an incorrect pattern, as shown below:</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732796660741.png" alt="Validate the fields extracted" /></p>

<p><strong>Save and Analyse</strong></p>

<p>After validating that the extracted fields are correct, the next step is saving and analysing the logs.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732796660777.png" alt="Save the Patterns" /></p>

<p>This tab shows us the regular expression created, the fields extracted, and the sample event that contains the fields we wanted to extract. Let’s save this session by clicking on the green <code class="language-plaintext highlighter-rouge">Finish</code> button at the top of the page and move on to the search tab to search the logs. To do so, we can click on the <code class="language-plaintext highlighter-rouge">Explore the fields I just created in Search</code> link on the next page.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732798665753.png" alt="Explore the extracted fields" /></p>

<p>We can verify that we successfully extracted the custom fields from the logs by clicking on any of our custom fields in the list on the left of the page. For example, if we click on the <code class="language-plaintext highlighter-rouge">UserName</code> field, we’ll be presented with all the different values that have been extracted from the logs for this field.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732798665743.png" alt="Search the extracted fields" /></p>

<p>It also appears that some fields have not been parsed exactly as we expected:</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1733104572467.png" alt="Search in Splunk" /></p>

<h2 id="improving-the-field-extraction">Improving the Field Extraction</h2>

<p>As previously mentioned, some of the logs are a bit different from the ones we used as a baseline for the field extraction. Some of the log formats that our parser could not pick are mentioned below: \n</p>

<table>
  <thead>
    <tr>
      <th><strong>Sample Log</strong></th>
      <th>2024-12-16 23:45:56 <strong>Login successful</strong> 3 marta tktfav3m1mggj0pfjb7onm4qcv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Sample Log</strong></td>
      <td>2024-12-16 22:47:12 Login failed glitch pass=ImtheB3st! rij5uu4gt204q0d3eb7jj86okt \n</td>
    </tr>
  </tbody>
</table>

<p>It is important to note that, there can be various ways to achieving our goal of fixing the parser. We will try of of the methods, as covered in steps below:</p>

<h2 id="removing-the-fields-extraction-n"><strong>Removing the Fields Extraction</strong> \n</h2>

<p>Let’s go to <code class="language-plaintext highlighter-rouge">Settings</code> -&gt; <code class="language-plaintext highlighter-rouge">Fields</code>, as shown below: \n</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1733105798908.png" alt="Navigate to Settings -&gt; Fields" /> \n</p>

<p><strong>Field Extraction</strong></p>

<p>Click on the <code class="language-plaintext highlighter-rouge">Field extractions</code>tab; it will display all the fields extracted. \n</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1733105980601.png" alt="Select Field Extractions Option" /> \n</p>

<p>**Delete the Regex Pattern \n **</p>

<p>This tab will display all the patterns/fields extracted so far in Splunk. We can look for the <code class="language-plaintext highlighter-rouge">cctv</code> related pattern in the list, or simply search <code class="language-plaintext highlighter-rouge">cctv</code> in the search bar, and it will display our recently created pattern. Once the right pattern is selected, click on the <code class="language-plaintext highlighter-rouge">Delete</code>button, as shown below. \n</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1733106086822.png" alt="Select the pattern and delete." /> \n</p>

<p>Why we are deleting this previously created pattern? Well, this regex picks fields from some logs and leave behind other logs, which may be vital for our investigation. \n Our goal is to create one generic regular expression, that works on almost all events. \n</p>

<p><strong>Open Filed Extractor</strong></p>

<p>Next, click on the <code class="language-plaintext highlighter-rouge">Open Field Extractor</code>button, and it will take us to the same tab, where we can extract the fields again. \n</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1733106631437.png" alt="Open Field Extractor" /> \n</p>

<p><strong>Update the Regex</strong></p>

<p>This time, after selecting the right source type as <code class="language-plaintext highlighter-rouge">cctv_logs</code>, and time range as <code class="language-plaintext highlighter-rouge">All Time</code>, click on <code class="language-plaintext highlighter-rouge">I prefer to write the regular expression myself</code>.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1733230148279.png" alt="Select the source, sourcetype and Time Range" /> \n</p>

<p>In the next tab, enter the regex <code class="language-plaintext highlighter-rouge">^(?P&lt;timestamp&gt;\d+\-\d+\-\d+\s+\d+:\d+:\d+)\s+(?P&lt;Event&gt;(Login\s\w+|\w+))\s+(?P&lt;user_id&gt;\d+)?\s?(?P&lt;UserName&gt;\w+)\s+.*?(?P&lt;Session_id&gt;\w+)$</code> and select <code class="language-plaintext highlighter-rouge">Preview</code>.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1733233226011.gif" alt="Update the Regular Expression" /> \n</p>

<p>This regex will fix the field parsing pattern and extract all needed fields from the logs. Hit <code class="language-plaintext highlighter-rouge">Save</code> and on the next page, select <code class="language-plaintext highlighter-rouge">Finish</code>.</p>

<p>On the next page, once again, click on the <code class="language-plaintext highlighter-rouge">Explore the fields I just created in Search</code>.</p>

<p>Now that we can observe that all fields are being extracted as we wanted, let’s start investigating the logs. \n</p>

<h2 id="investigating-the-cctv-footage-logs">Investigating the CCTV Footage Logs</h2>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/66b36e2379a5d0220fc6b99e/room-content/66b36e2379a5d0220fc6b99e-1732019992566.png" alt="" title="right-50" /></p>

<p>Now that we have sanitized and properly parsed the logs, it’s time to examine them and find the culprit.</p>

<p><strong>Summary of the CCTV Feed</strong></p>

<p>After examining the CCTV feed logs, we can create a mental picture of the information these logs provide us. A brief summary of these logs is:</p>

<ul>
  <li>These logs contain the successful and failed login attempts from various users.</li>
  <li>They contain a few failed login attempts, which looks suspicious.</li>
  <li>They contain information about the CCTV footage being watched and downloaded.</li>
</ul>

<p><strong>Event Count by Each User</strong></p>

<p>Let’s use the following search query to see the count of events by each user:</p>

<p><code class="language-plaintext highlighter-rouge">index=cctv_feed | stats count(Event) by UserName</code></p>

<p>We can easily visualise this data by first clicking on <code class="language-plaintext highlighter-rouge">Visualization</code> below the search bar, then change the visualisation type from <strong>Bar Chart</strong> to <strong>Pie Chart</strong>.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732644352681.png" alt="Show results in Bar Chart" /></p>

<p><strong>Summary of the Event Count</strong></p>

<p>We can create a summary of the event count to see what activities were captured in the logs using the following query:</p>

<p><code class="language-plaintext highlighter-rouge">index=cctv_feed | stats count by Event</code></p>

<p>Splunk will automatically display the previously selected <strong>Pie Chart</strong> type of visualisation.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1733109548199.png" alt="Visualize results in PIE chart" /> \n</p>

<p><strong>Examining Rare Events</strong></p>

<p>Using the following search query, let’s look at the events with fewer occurrences in the event field to see if we can find something interesting:</p>

<p><code class="language-plaintext highlighter-rouge">index=cctv_feed | rare Event</code></p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1733227064365.png" alt="Examine the rare Events captured" /> \n</p>

<p>It looks like we have a few attempts to delete the recording and a few failed login attempts. This means we have a clue. Let’s now examine the failed login attempts first:</p>

<p><code class="language-plaintext highlighter-rouge">index=cctv_feed *failed* | table _time UserName Event Session_id</code></p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732648002272.png" alt="Create a table of interesting fields" /></p>

<p>We found some failed login attempts against four users, but one thing remains constant: the Session_id.</p>

<p><strong>Narrowing Down Our Investigation</strong></p>

<p>Let’s narrow down our results to see what other events are associated with this <code class="language-plaintext highlighter-rouge">Session_id</code>:</p>

<p><code class="language-plaintext highlighter-rouge">index=cctv_feed *put_Session_id_here* | table _time UserName Event Session_id</code></p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732647489220.gif" alt="Examine the logs" /></p>

<p>Let’s see how many events related to the deletion of the CCTV footage were captured.</p>

<p><code class="language-plaintext highlighter-rouge">index=cctv_feed *Delete*</code> \n</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732648512597.png" alt="Examine the logs related to Delete Activity" /></p>

<p>Good. We have some comprehensive information about the attacker and his notorious activities.</p>

<p><strong>Correlating With the Web Logs</strong></p>

<p>Let’s use the information extracted from the earlier investigation and correlate it with the web logs.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732660108101.png" alt="Narrow Down the results" /></p>

<p><strong>Suspicious IP Address</strong></p>

<p>During the examination, it is observed that only one IP address 10.11.105.33 is associated with the suspicious session ID.</p>

<p>Identify the footprint associated with the session ID.</p>

<p><code class="language-plaintext highlighter-rouge">index=web_logs *rij5uu4gt204q0d3eb7jj86okt*</code> \n</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732659354913.png" alt="Find Suspicious IP" /></p>

<p>Let’s narrow down the search to show results associated with the IP address found earlier. It is also important to note that, in this case, the details about the session IDs are found in the field status.</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732660374066.png" alt="Narrow Down the result" /></p>

<p>It looks like two more Session IDs were associated with the IP address found earlier. Let’s create a search to observe what kind of activities were captured associated with the IP and these session IDs.</p>

<p><code class="language-plaintext highlighter-rouge">index=web_logs clientip="10.11.105.33" | table _time clientip status uri ur_path file</code> \n</p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732660865560.png" alt="Examine the Logs" /></p>

<p>Looking closely, we can see logout events when the session ID was changed. Can we correlate these session IDs in the cctv_feeds logs and see if we can find any evidence?</p>

<p><strong>Connecting the Dots</strong></p>

<p>Let’s go back to <code class="language-plaintext highlighter-rouge">cctv_feed</code> and use these session IDs associated with the IP address, as shown below:</p>

<p><code class="language-plaintext highlighter-rouge">index=cctv_feed *lsr1743nkskt3r722momvhjcs3*</code></p>

<p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1732661207278.png" alt="Examine the logs" /></p>

<p>Great, we were able to locate the user name associated with the attack. Now that we have identified the user, let’s summarise our investigation.</p>

<p>From the output, it seems the following was the timeline of the attack:</p>

<ul>
  <li>Attacker bruteforce attempt on various accounts.</li>
  <li>There was a successful login after the failed attempts.</li>
  <li>Attacker watched some of the camera streams.</li>
  <li>Multiple camera streams were downloaded.</li>
  <li>Followed by the deletion of the CCTV footage.</li>
  <li>The web logs had an IP address associated with the attacker’s session ID.</li>
  <li>We found two other session IDs associated with the IP address.</li>
  <li>We correlated back to the cctv_feed logs to find the traces of any evidence revolving around those session IDs, and found the name of the attacker.</li>
</ul>

<h2 id="answer-the-questions-below">Answer the questions below</h2>

<p>Extract all the events from the cctv_feed logs. How many logs were captured associated with the successful login?</p>

<p>642</p>

<p>What is the Session_id associated with the attacker who deleted the recording?</p>

<p>rij5uu4gt204q0d3eb7jj86okt</p>

<p>What is the name of the attacker found in the logs, who deleted the CCTV footage?</p>

<p>mmalware</p>

<p>Check out the <a href="https://tryhackme.com/jr/splunkdatamanipulation">Splunk: Data Manipulation</a> room to learn more about parsing and manipulating data in Splunk.</p>

<p>Good thing we had a backup of the CCTV application from yesterday. We got it running again in no time!</p>

  </article>
  
    <div class="post-share">
  <div class="post-date">Feel free to share!</div>
  <div class="sharing-icons">
    <a href="https://twitter.com/intent/tweet?text=TryHackMe Advent of Cyber - Day 17&amp;url=/Day17" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=/Day17&amp;title=TryHackMe Advent of Cyber - Day 17" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
  </div>
</div>

  
  
    <div class="related">
  <h2>You may also enjoy...</h2>
  
  <ul class="related-posts">
    
  </ul>
</div>

  
  
    <section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = "tryhackme-advent-of-cyber-2024-mberger-writeup";
    var disqus_identifier = "/Day17";
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

  
</div>

      </div>
      <footer class="footer">
  
    <a href="https://twitter.com/mberger" class="menu-link" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
  
    <a href="feed.xml" class="menu-link" target="_blank"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
  
  <div class="footer-description"><a href="/">THM Advent of Cyber 2024 | a minimalist Jekyll theme for running a blog or publication by Michael</a></div>
</footer>

    </div>
  </body>
</html>
